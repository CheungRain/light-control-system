{"ast":null,"code":"import { createElementVNode as _createElementVNode, vShow as _vShow, withDirectives as _withDirectives, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nimport _imports_0 from '../../assets/images/voiceToText/mic.png';\nconst _withScopeId = n => (_pushScopeId(\"data-v-a01c3592\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"voiceToText\"\n};\nconst _hoisted_2 = {\n  class: \"close\"\n};\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"voice-header\"\n}, \" 请说出搜索信息 \", -1 /* HOISTED */));\nconst _hoisted_4 = {\n  class: \"wrap-recorder\"\n};\nconst _hoisted_5 = {\n  id: \"container\"\n};\nconst _hoisted_6 = {\n  class: \"circle circle--3\"\n};\nconst _hoisted_7 = {\n  class: \"circle circle--5\"\n};\nconst _hoisted_8 = {\n  class: \"tip\"\n};\nconst _hoisted_9 = {\n  class: \"controller\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"i\", {\n    class: \"el-icon-close\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.closeVoice && $options.closeVoice(...args))\n  })]), _hoisted_3, _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", null, [_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"img\", {\n    src: _imports_0,\n    alt: \"\",\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.handleClick && $options.handleClick(...args))\n  }), _withDirectives(_createElementVNode(\"div\", _hoisted_6, null, 512 /* NEED_PATCH */), [[_vShow, $data.recording]]), _withDirectives(_createElementVNode(\"div\", _hoisted_7, null, 512 /* NEED_PATCH */), [[_vShow, $data.recording]])])]), _createElementVNode(\"p\", _hoisted_8, _toDisplayString($data.tiptext), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_9, [_createVNode(_component_el_button, {\n    class: \"controller-cancel\",\n    onClick: $options.closeVoice\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"取消\")]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onClick\"]), _createVNode(_component_el_button, {\n    class: \"controller-ensure\",\n    onClick: $options.setMp3\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"确认\")]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onClick\"])])]);\n}","map":{"version":3,"names":["_imports_0","class","_createElementVNode","id","_createElementBlock","_hoisted_1","_hoisted_2","onClick","_cache","args","$options","closeVoice","_hoisted_3","_hoisted_4","_hoisted_5","src","alt","handleClick","_hoisted_6","$data","recording","_hoisted_7","_hoisted_8","_toDisplayString","tiptext","_hoisted_9","_createVNode","_component_el_button","setMp3"],"sources":["D:\\javafile\\LightControl\\src\\views\\IndexPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"voiceToText\">\r\n    <div class=\"close\">\r\n      <i class=\"el-icon-close\" @click=\"closeVoice\"></i>\r\n    </div>\r\n    <div class=\"voice-header\">\r\n      请说出搜索信息\r\n    </div>\r\n    <div class=\"wrap-recorder\">\r\n      <div>\r\n        <div id=\"container\">\r\n          <img src=\"../../assets/images/voiceToText/mic.png\" alt=\"\" @click=\"handleClick\">\r\n          <div class='circle circle--3' v-show=\"recording\"></div>\r\n          <div class='circle circle--5' v-show=\"recording\"></div>\r\n        </div>\r\n\r\n      </div>\r\n      <p class=\"tip\">{{ tiptext }}</p>\r\n    </div>\r\n    <div class=\"controller\">\r\n      <el-button class=\"controller-cancel\" @click=\"closeVoice\">取消</el-button>\r\n      <el-button class=\"controller-ensure\" @click=\"setMp3\">确认</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {$post} from \"@/config/http/http\";\r\n\r\nexport default {\r\n  name: \"voiceToText\",\r\n  data() {\r\n    return {\r\n      tiptext: \"点击录音\",\r\n      recording: false, // 标记是否在录音\r\n      intervaltimerid: \"\", // 间隔时间定时器编号\r\n      recorder: null,\r\n      time: 0,\r\n      url:'',//地址\r\n      mblob:'',//文件\r\n    };\r\n  },\r\n  props:{\r\n    visibility:{\r\n      type:Boolean,\r\n      default:false\r\n    }\r\n  },\r\n  watch:{\r\n\r\n  },\r\n  mounted() {\r\n    this.init()\r\n  },\r\n  methods:{\r\n    closeVoice(){\r\n      this.recording = false;\r\n      clearInterval(this.intervaltimerid);\r\n      this.recorder.stop();\r\n      this.tiptext = \"点击录音\";\r\n      this.$emit('closeVoice',false)\r\n      console.log('zi')\r\n    },\r\n    init() {\r\n      this.recorder = new MP3Recorder({\r\n        //numChannels: 1,     //声道数,默认为1\r\n        sampleRate: 16000,   //采样率,一般由设备提供,比如 48000\r\n        bitRate: 128, //比特率,不要低于64,否则可能录制无声音（人声）\r\n        //useMediaRecorder: true, //是否使用MediaRecorder录音（不支持转码为mp3文件）\r\n        //recorderType: \"video/webm;codes=vp9\",  //默认编码，仅 useMediaRecorder 为true且浏览器支持时生效\r\n        //录音结束事件\r\n        complete: (blob, ext) => {\r\n          var url = URL.createObjectURL(blob);\r\n          this.$emit(\"handleStop\", {\r\n            url: url,\r\n            mblob: blob\r\n          });\r\n          this.url = url;\r\n          this.mblob = blob;\r\n        }\r\n      });\r\n    },\r\n    // 点击处理\r\n    handleClick() {\r\n      //录音支持检测\r\n      console.log(this.recorder.support)\r\n      if (!this.recorder.support) return;\r\n      this.recording = !this.recording;\r\n      this.$emit(\"handleStop\", {\r\n        url: \"\",\r\n        mblob: null,\r\n      });\r\n      if (this.recording) {\r\n        this.time = 0;\r\n        this.tiptext = \"正在录音... (\" + this.time + \"s)\";\r\n        this.recorder.start(this.successFun(), this.errorFun());\r\n      } else {\r\n        clearInterval(this.intervaltimerid);\r\n        this.recorder.stop();\r\n        this.tiptext = \"点击录音\";\r\n      }\r\n    },\r\n    writeError() {},\r\n    successFun() {\r\n      this.intervaltimerid = setInterval(() => {\r\n        // 开始累积\r\n        if (this.time == 60) {\r\n          this.recorder.stop();\r\n          this.recording = false;\r\n          this.tiptext = \"点击录音\";\r\n          console.log(\"对不起，录音只支持60秒以内的语音！\");\r\n          this.$message({\r\n            message: '对不起，录音只支持60秒以内的语音！',\r\n            type: 'warning'\r\n          });\r\n          clearInterval(this.intervaltimerid);\r\n          return false;\r\n        }\r\n        this.time = this.time + 1;\r\n        this.tiptext = \"正在录音... (\" + this.time + \"s)\";\r\n      }, 1000);\r\n    },\r\n    errorFun(e) {\r\n      // clearInterval(this.intervaltimerid);\r\n      // switch (e.code || e.name) {\r\n      //   case \"PERMISSION_DENIED\":\r\n      //   case \"PermissionDeniedError\":\r\n      //     // this.writeError(\"用户拒绝提供设备。\");\r\n      //     break;\r\n      //   case \"NOT_SUPPORTED_ERROR\":\r\n      //   case \"NotSupportedError\":\r\n      //     // this.writeError(\"浏览器不支持硬件设备。\");\r\n      //     break;\r\n      //   case \"MANDATORY_UNSATISFIED_ERROR\":\r\n      //   case \"MandatoryUnsatisfiedError\":\r\n      //     // this.writeError(\"无法发现指定的硬件设备。\");\r\n      //     break;\r\n      //   default:\r\n      //     // this.writeError(ijutr\r\n      //     //   \"无法打开麦克风。异常信息:\" + (e.code || e.name)\r\n      //     // );\r\n      //     break;\r\n      // }\r\n    },\r\n    setMp3(){\r\n      // phoneLogin(formData).then((res)=>{\r\n      //   console.log(res)\r\n      // })\r\n      if (!!this.recording){\r\n        this.recording = false;\r\n        clearInterval(this.intervaltimerid);\r\n        this.recorder.stop();\r\n        this.tiptext = \"点击录音\";\r\n      }\r\n      setTimeout(()=>{\r\n        if (!!!this.mblob){\r\n          this.$message.error('请先录音');\r\n        }\r\n        //如果这里出现文件报错   请修改record.js中 worker = new Worker(ops.WORKER_PATH || '/js/recorder/recorder-worker.js');\r\n        console.log(this.mblob)\r\n        var formData = new FormData()\r\n        formData.append('file', this.mblob)\r\n        $post('/public/psBaiduSpeechRecognition/getSpeechRecognition',formData).then(res=>{\r\n          console.log(res.data.result[0])\r\n          this.$emit(\"voiceText\", res.data.result[0]);\r\n          this.mblob = '';\r\n          this.url = '';\r\n        })\r\n      },500)\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.voiceToText{\r\n  position: absolute;\r\n  z-index: 9999;\r\n  width: 451px;\r\n  height: 365px;\r\n  background: rgba(0,23,28,0.70);\r\n  border: 2px solid rgba(59,215,238,0.60);\r\n  top:calc(50% - 183px);\r\n  left:calc(50% - 225px);\r\n  .close{\r\n    width: 100%;\r\n    height: 25px;\r\n    text-align: right;\r\n    line-height: 25px;\r\n    padding-right: 5px;\r\n    color: #ffffff;\r\n    font-size: 18px;\r\n    position: absolute;\r\n    top: 0;\r\n    i{\r\n      cursor: pointer;\r\n    }\r\n  }\r\n\r\n  .voice-header{\r\n    width: 100%;\r\n    height: 60px;\r\n    line-height: 40px;\r\n    text-align: center;\r\n    font-size: 18px;\r\n    color: #ffffff;\r\n    background: url(\"~@/assets/images/voiceToText/header.png\") 50% 50% no-repeat;\r\n  }\r\n\r\n  .wrap-recorder {\r\n    text-align: center;\r\n    .icon {\r\n      cursor: pointer;\r\n    }\r\n    .tip {\r\n      padding-top: 20px;\r\n      color: #ffffff;\r\n      font-size: 18px;\r\n    }\r\n  }\r\n  .anirecorder {\r\n    position: relative;\r\n    animation: mymove 5s infinite;\r\n    animation-direction: alternate;\r\n    animation-timing-function: ease-in-out;\r\n  }\r\n\r\n  @keyframes mymove {\r\n    0% {\r\n      transform: scale(1); /*开始为原始大小*/\r\n    }\r\n    25% {\r\n      transform: scale(1.1); /*放大1.1倍*/\r\n    }\r\n    50% {\r\n      transform: scale(0.9);\r\n    }\r\n    75% {\r\n      transform: scale(1.1);\r\n    }\r\n  }\r\n\r\n\r\n  #container {\r\n    width: 125px;\r\n    height: 125px;\r\n    position: relative;\r\n    margin: 10px auto 0;\r\n    transition: opacity 1s;\r\n    img{\r\n      width: 30px;\r\n      height: 40px;\r\n      position: absolute;\r\n      top: calc(50% - 20px);\r\n      left: calc(50% - 15px);\r\n      z-index: 99;\r\n    }\r\n  }\r\n  .circle {\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    border-radius: 50%;\r\n    animation: pulse 3s infinite ease-in-out;\r\n    background: #11bfc2;\r\n  }\r\n\r\n  .circle--3 {\r\n    opacity: 0.3333;\r\n    animation-delay: 0.36s;\r\n  }\r\n\r\n  .circle--5 {\r\n    opacity: 0.2;\r\n    animation-delay: 0.6s;\r\n  }\r\n\r\n  .circle--3 {\r\n    width: 50%;\r\n    height: 50%;\r\n  }\r\n  .circle--5 {\r\n    width: 80%;\r\n    height: 80%;\r\n  }\r\n\r\n  @keyframes pulse {\r\n    0% {\r\n      transform: translate(-50%, -50%) scale(1);\r\n    }\r\n    25% {\r\n      transform: translate(-50%, -50%) scale(1.3);\r\n    }\r\n    50% {\r\n      transform: translate(-50%, -50%) scale(0.70);\r\n    }\r\n    75% {\r\n      transform: translate(-50%, -50%) scale(1);\r\n    }\r\n  }\r\n\r\n  .controller{\r\n    width: 100%;\r\n    height: 120px;\r\n    line-height: 120px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    button{\r\n      width: 120px;\r\n      height: 40px;\r\n      margin-right: 20px;\r\n      margin-left: 20px;\r\n    }\r\n    .controller-cancel{\r\n      background: rgba(0,0,0,0.52);\r\n      border: 1px solid rgba(113,215,214,0.57);\r\n      border-radius: 5px;\r\n      color: #ffffff;\r\n    }\r\n    .controller-ensure{\r\n      background: rgba(2,69,68,0.65);\r\n      border: 2px solid #80fffd;\r\n      border-radius: 5px;\r\n      color: #ffffff;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n"],"mappings":";OAWeA,UAA6C;;;EAVrDC,KAAK,EAAC;AAAa;;EACjBA,KAAK,EAAC;AAAO;gEAGlBC,mBAAA,CAEM;EAFDD,KAAK,EAAC;AAAc,GAAC,WAE1B;;EACKA,KAAK,EAAC;AAAe;;EAEjBE,EAAE,EAAC;AAAW;;EAEZF,KAAK,EAAC;AAAkB;;EACxBA,KAAK,EAAC;AAAkB;;EAI9BA,KAAK,EAAC;AAAK;;EAEXA,KAAK,EAAC;AAAY;;;uBAlBzBG,mBAAA,CAsBM,OAtBNC,UAsBM,GArBJH,mBAAA,CAEM,OAFNI,UAEM,GADJJ,mBAAA,CAAiD;IAA9CD,KAAK,EAAC,eAAe;IAAEM,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAC,UAAA,IAAAD,QAAA,CAAAC,UAAA,IAAAF,IAAA,CAAU;QAE7CG,UAEM,EACNV,mBAAA,CAUM,OAVNW,UAUM,GATJX,mBAAA,CAOM,cANJA,mBAAA,CAIM,OAJNY,UAIM,GAHJZ,mBAAA,CAA+E;IAA1Ea,GAA6C,EAA7Cf,UAA6C;IAACgB,GAAG,EAAC,EAAE;IAAET,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAO,WAAA,IAAAP,QAAA,CAAAO,WAAA,IAAAR,IAAA,CAAW;sBAC7EP,mBAAA,CAAuD,OAAvDgB,UAAuD,gC,SAAjBC,KAAA,CAAAC,SAAS,E,mBAC/ClB,mBAAA,CAAuD,OAAvDmB,UAAuD,gC,SAAjBF,KAAA,CAAAC,SAAS,E,OAInDlB,mBAAA,CAAgC,KAAhCoB,UAAgC,EAAAC,gBAAA,CAAdJ,KAAA,CAAAK,OAAO,iB,GAE3BtB,mBAAA,CAGM,OAHNuB,UAGM,GAFJC,YAAA,CAAuEC,oBAAA;IAA5D1B,KAAK,EAAC,mBAAmB;IAAEM,OAAK,EAAEG,QAAA,CAAAC;;sBAAY,MAAE,C,iBAAF,IAAE,E;;kCAC3De,YAAA,CAAmEC,oBAAA;IAAxD1B,KAAK,EAAC,mBAAmB;IAAEM,OAAK,EAAEG,QAAA,CAAAkB;;sBAAQ,MAAE,C,iBAAF,IAAE,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}